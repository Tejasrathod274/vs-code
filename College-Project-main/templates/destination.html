<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ name }} | Travel India</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/common.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/destination.css') }}">
  <script src="{{ url_for('static', filename='js/common.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/destination.js') }}" defer></script>
</head>
<body class="has-navbar">
  <nav class="navbar">
    <div class="menu-toggle" onclick="toggleMenu()">
      <i class="fas fa-bars"></i>
    </div>
    <a href="{{ url_for('index') }}" class="logo">Travel<span>India</span></a>
    <div class="nav-links">
      <a href="{{ url_for('index') }}#home">Home</a>
      <a href="{{ url_for('index') }}#destinations" class="active">Destinations</a>
      <a href="{{ url_for('more_places') }}">More Places</a>
      <a href="{{ url_for('index') }}#about">About</a>
    </div>
    <div class="nav-right">
      <a href="{{ url_for('login') }}" class="nav-login" id="navLogin" style="display: inline-block;">Login</a>
      <div class="user-profile" id="userProfile" style="display: none;" onclick="toggleDropdown()">
        <i class="fas fa-user-circle"></i>
        <div class="dropdown" id="profileDropdown">
          <a href="{{ url_for('profile') }}">My Account</a>
          <a href="{{ url_for('logout') }}" id="logoutBtn">Logout</a>
        </div>
      </div>
    </div>
  </nav>

  <main class="destination-main">
    <div class="breadcrumb">
      <a href="{{ url_for('index') }}">Home</a>
      <span class="sep">/</span>
      <span id="breadcrumbDest">{{ name }}</span>
    </div>
    <h1 class="destination-title reveal" id="destinationTitle">{{ name }}</h1>
    <p class="destination-desc reveal" id="destinationDesc">Explore places — click a place to see its hotels and restaurants.</p>

    <section class="dest-hero reveal" id="destHero">
      <div class="dest-hero-image" id="destHeroImage"></div>
      <div class="dest-hero-text">
        <h2>About {{ name }}</h2>
        <p class="about-dest-paragraph" id="aboutDestParagraph"></p>
      </div>
    </section>

    <section class="dest-section">
      <h2><i class="fas fa-map-marker-alt"></i> Landmarks & Places to Visit</h2>
      <div class="dest-cards" id="placesContainer"></div>
    </section>

    <section class="dest-section">
      <h2><i class="fas fa-route"></i> Tours</h2>
      <div class="dest-cards" id="toursContainer"></div>
    </section>
  </main>

  <footer class="footer">
    <div class="footer-bottom">
      <a href="{{ url_for('index') }}">← Back</a> &nbsp;|&nbsp; © 2026 TravelIndia. All rights reserved.
    </div>
  </footer>

  <script src="{{ url_for('static', filename='js/destination-data.js') }}"></script>
  <script>
    var STATIC_BASE = "{{ static_base }}";
    function toggleDropdown() {
      document.getElementById('profileDropdown').classList.toggle('show');
    }
    window.onclick = function(e) {
      if (!e.target.closest('.user-profile')) {
        document.getElementById('profileDropdown').classList.remove('show');
      }
    };

    var IS_LOGGED_IN = {{ 'true' if logged_in else 'false' }}
    var name = "{{ name }}";
    var key = name.toLowerCase();
    var data = window.DESTINATION_DATA[key] || window.DESTINATION_DATA.kerala;
    if (STATIC_BASE) {
      function fixImg(obj) {
        if (obj.image) obj.image = STATIC_BASE + obj.image;
        return obj;
      }
      data.places = data.places.map(fixImg);
      if (data.tours) data.tours = data.tours.map(fixImg);
    }

    document.getElementById('destinationDesc').textContent = data.description;
    var aboutText = data.aboutParagraph || data.description;
    document.getElementById('aboutDestParagraph').textContent = aboutText;
    var heroEl = document.getElementById('destHeroImage');
    if (data.heroImage && heroEl) {
      var heroSrc = STATIC_BASE ? STATIC_BASE + data.heroImage : data.heroImage;
      heroEl.style.backgroundImage = 'url(' + heroSrc + ')';
    }

    var destName = name;
    var placeDetailBase = "{{ url_for('place_detail', dest_name=name, place_name='__PLACE__') }}";

    function renderCards(containerId, items, type) {
      var container = document.getElementById(containerId);
      if (!container) return;
      container.innerHTML = items.map(function(item) {
        var img = item.image ? '<img src="' + item.image + '" alt="' + item.name + '">' : '<div class="card-placeholder"><i class="fas fa-' + (type === 'tour' ? 'route' : 'image') + '"></i></div>';
        var info = type === 'tour' && item.price ? '<p class="info-text">' + item.price + '</p>' : '';
        var btn = '';
        if (type === 'tour') {
          var bookUrl = '{{ url_for("book_tour") }}?destination=' + encodeURIComponent(destName) + '&tour=' + encodeURIComponent(item.name) + '&price=' + encodeURIComponent(item.price || '') + '&description=' + encodeURIComponent(item.description || '');
          if (IS_LOGGED_IN) {
            btn = '<a href="' + bookUrl + '" class="effect-btn">Book Tour</a>';
          } else {
            btn = '<a href="{{ url_for("login") }}" class="effect-btn">Book Tour</a>';
          }
        } else {
          var placeUrl = placeDetailBase.replace('__PLACE__', encodeURIComponent(item.name));
          if (IS_LOGGED_IN) {
            btn = '<a href="' + placeUrl + '" class="effect-btn place-explore-btn">Explore →</a>';
          } else {
            btn = '<a href="{{ url_for("login") }}" class="effect-btn">Explore →</a>';
          }
        }
        return '<div class="card reveal">' + img + '<div class="card-content"><h3>' + item.name + '</h3><p>' + item.description + '</p>' + info + btn + '</div></div>';
      }).join('');
    }

    renderCards('placesContainer', data.places, 'place');
    renderCards('toursContainer', data.tours || [], 'tour');
    setTimeout(function() {
      document.querySelectorAll('.destination-main .reveal').forEach(function(el) { el.classList.add('active'); });
    }, 150);
  </script>
  <script src="{{ url_for('static', filename='js/success-bar.js') }}" defer></script>
</body>
</html>
